# MCPX Roadmap

## 项目状态

根据 [验证文档](./verification.md)，核心功能（8 个条款）已全部完成：
- ✅ FastMCP 框架架构
- ✅ 工具注册表与缓存
- ✅ 长连接执行器
- ✅ MCP 代理服务器（inspect + exec）
- ✅ 双传输方式（stdio + HTTP/SSE）
- ✅ 配置驱动
- ✅ 错误处理与降级
- ✅ E2E 测试覆盖（74%）

当前分支 `add-docker-support` 正在开发 Docker 支持。

---

## 待办事项

### P0 - 紧急 / 高价值

#### 1. 🔄 连接稳定性（通过 ProxyProvider 实现）
**状态**：待开发  
**描述**：采用 FastMCP ProxyProvider 重构连接管理，利用其 Session Isolation 特性获得连接恢复能力。

**背景**：
FastMCP ProxyProvider 的 Session Isolation 设计意味着每个请求可获得独立会话，无需手动实现重连逻辑：
- 当前 MCPX：长连接 + 手动重连 = 复杂度高
- ProxyProvider：会话隔离 = 隐式连接恢复

**实现要点**：
- 使用 `ProxyClient` 替代手动 `Client` 管理
- 利用 session isolation 特性处理连接断开
- 保持 `inspect`/`exec` 接口不变
- 可选：添加连接失败时的重试配置

**收益**：
- 简化连接管理代码
- 隐式获得连接恢复能力
- 减少自定义重连逻辑

**影响范围**：
- `src/mcpx/registry.py`：使用 ProxyClient 重构

**注意**：此条目合并了原"连接重连机制"和"FastMCP ProxyProvider 集成评估"。

---

#### 2. 🐳 Docker 支持
**状态**：开发中（`add-docker-support` 分支）  
**描述**：提供 Dockerfile 和使用文档，支持容器化部署。

**已完成**：
- ✅ Dockerfile（多阶段构建）
- ✅ .dockerignore
- ✅ README 文档更新

**待验证**：
- [ ] 构建和运行测试

---

### P1 - 高优先级

#### 3. 📦 TOON 格式压缩
**状态**：待开发  
**描述**：当 `exec` 返回的结果是 JSON 数据时，使用 [TOON 格式](https://github.com/toon-format/toon) 进行压缩，减少 token 消耗。

**背景**：
TOON（Token-Oriented Object Notation）是专为 LLM 设计的紧凑数据格式：
- 比 JSON 节省约 40% token
- 对表格数据压缩效果尤佳（统一结构的对象数组）
- 保持可读性和无损转换

**实现要点**：
- 添加 `toon_format` Python 依赖
- 在 `exec` 返回结果时检测 JSON 数据
- 对符合条件的数据进行 TOON 编码
- 可配置开关（`enable_toon_compression: bool`）
- 在返回结果中标注格式类型

**注意事项**：
- TOON 对深度嵌套 / 非结构化数据效果不佳，需评估适用场景
- 需确保 AI 客户端能正确解析 TOON 格式

---

#### 4. 💓 健康检查与心跳
**状态**：待开发  
**描述**：定期检测 MCP 服务器连接状态，主动发现断连。

**实现要点**：
- 定期心跳探测（可配置间隔，默认 30s）
- 健康状态 API（`/health` 端点）
- 不健康服务器的标记和隔离
- 与重连机制联动

---

### P2 - 中优先级

#### 5. 📊 可观测性增强
**状态**：待开发  
**描述**：添加日志、指标和追踪支持。

**实现要点**：
- 结构化日志（JSON 格式）
- 关键指标暴露：
  - 连接状态和数量
  - 工具调用次数和延迟
  - 错误率
- OpenTelemetry 集成（可选）

---

#### 6. ⚡ 性能优化
**状态**：待开发  
**描述**：提升高并发场景下的性能表现。

**实现要点**：
- 连接池优化（复用策略）
- 并发限制（每服务器最大并发数）
- 请求超时配置
- 工具结果缓存（可选，短 TTL）

---

#### 7. 🧪 测试覆盖率提升
**状态**：持续改进  
**描述**：将测试覆盖率从 74% 提升到 85%+。

**重点区域**：
- 边界条件和错误路径
- 并发场景
- 配置解析

---

### P3 - 低优先级

#### 8. 🔥 配置热加载
**状态**：待开发  
**描述**：支持不重启服务更新配置。

**实现要点**：
- 监听配置文件变更
- 增量更新连接（新增/移除服务器）
- 配置变更事件通知

---

#### 9. 🖥️ Web 管理界面
**状态**：待开发  
**描述**：提供可视化管理界面。

**功能**：
- 服务器连接状态
- 工具列表和调用统计
- 配置管理
- 日志查看

---

#### 10. 🔌 连接池动态扩缩容
**状态**：待开发  
**描述**：根据负载自动调整连接池大小。

---

## 优先级说明

| 优先级 | 含义 | 决策依据 |
|--------|------|----------|
| P0 | 紧急 / 高价值 | 影响核心稳定性或已在开发中 |
| P1 | 高优先级 | 对用户体验有重大提升 |
| P2 | 中优先级 | 改进性能和可维护性 |
| P3 | 低优先级 | 锦上添花，可延后 |

---

## 版本规划（建议）

### v0.2.0 - 稳定性版本
- [ ] 连接稳定性（ProxyProvider 重构）
- [ ] Docker 支持完成
- [ ] 健康检查

### v0.3.0 - 优化版本
- [ ] TOON 格式压缩
- [ ] 可观测性增强
- [ ] 性能优化

### v0.4.0 - 功能版本
- [ ] 配置热加载
- [ ] Web 管理界面

---

*最后更新：2026-01-24*
